var NAME="Schoolloop Editor",URL=window.location.href.split(/\/+|\./),HTTP=URL[0];URL[4]&&"progress_report"==URL[4]||(URL[4]&&"schoolloop"==URL[2]&&"com"==URL[3]?alert("You must be on a progress report for "+NAME+" to work"):alert("You must be on schoolloop for "+NAME+" to work"));var pageConstants={weightTitle:"Weight",weightScoreTitle:"Weight Score"},constants={weightsCategory:"Category",weightsWeight:"Weight",assignmentCategory:"Category",assignmentName:"name",assignmentMaxScore:"maxScore",assignmentStudentScore:"studentScore"},Retriever={getScoresTitles:function(){var a=document.getElementsByClassName("module_content")[0].getElementsByTagName("tr")[0];return a},getScoresContent:function(){var a=document.getElementsByClassName("module_content")[0].getElementsByTagName("tr");return a=[...a],a.shift(),a},getScoresAttrOf:function(a){for(var b=[],c=0;c<a.children.length;c++)b[c]=a.children[c].innerHTML.replace(":","");return b},getScoresAttr:function(){var a=this.getScoresTitles();return this.getScoresAttrOf(a)},scoresCategoryCollection:function(){for(var a=[],b=this.getScoresContent(),c=this.getScoresAttr(),d=0;d<b.length;d++){a[d]=new Object;for(var e=b[d],f=0;f<e.children.length;f++)a[d][c[f]]=e.children[f].innerHTML}return a},getGradeLegendTbl:function(){return document.getElementsByClassName("module_content")[2]},getGradeLegendCodesOf:function(a){for(var b=[],c=a.children[0].children[0].children,d=1;d<c.length;d++)b[d-1]=c[d].children[0].innerText.split(":")[0];return b},getGradeLegendCodes:function(){var a=this.getGradeLegendTbl();return this.getGradeLegendCodesOf(a)},getAssignmentTbl:function(){var a=document.getElementsByClassName("general_body")[0];return a},getAssignmentCategory:function(a){return a.children[0].children[0].innerText.split("\n")[0].trim()},getAssignmentName:function(a){return a.children[0].children[0].innerText.split("\n")[1].trim()},getAssignmentNameElement:function(a){return a.children[0].children[0]},getAssignmentScoreMax:function(a){var b=a.children[3].innerText;return b.split("/")[1]&&b.split("/")[1].split(" ")[1]?parseFloat(b.split("/")[1].split(" ")[1]):0},getAssignmentScore:function(a){return parseFloat(a.children[3].children[0].innerText.split(" ")[1])?parseFloat(a.children[3].children[0].innerText.split(" ")[1]):0},getAssignmentCollection:function(){for(var a=[],b=this.getAssignmentTbl(),c=0;c<b.children.length;c++)a[c]=new Object,a[c][constants.assignmentCategory]=this.getAssignmentCategory(b.children[c]),a[c][constants.assignmentName]=this.getAssignmentName(b.children[c]),a[c][constants.assignmentMaxScore]=this.getAssignmentScoreMax(b.children[c]),a[c][constants.assignmentStudentScore]=this.getAssignmentScore(b.children[c]);return a}},DataHandling={findTotalWeightOf:function(a){if(!a||0==a.length)return-1;if(!a[0][pageConstants.weightTitle])return-1;for(var b=0,c=0;c<a.length;c++)b+=parseFloat(a[c][pageConstants.weightTitle]);return b},Category:function(){this.weight=0,this.cat="",this.studentPoints=0,this.maxPoints=0},findCategoryPointsOf:function(a,b){for(var c=[],d=0;d<b.length;d++)if(c[d]=new this.Category,b[d][constants.weightsCategory]?c[d].cat=b[d][constants.weightsCategory]:c[d].cat=d+"?",b[d][constants.weightsWeight]){var e=parseFloat(b[d][constants.weightsWeight]);e||(e=0),c[d].weight=e}else c[d].weight=d+"?";for(var d=0;d<a.length;d++)for(var f=a[d][constants.assignmentCategory],g=a[d][constants.assignmentStudentScore],h=a[d][constants.assignmentMaxScore],i=0;i<c.length;i++)f==c[i].cat&&(c[i].maxPoints+=h,c[i].studentPoints+=g);return c},calculateTotalGrade:function(a,b,c){var d=[];if(b){for(var e=0;e<c.categoryChecks.length;e++)if(c.categoryChecks[e].checked)for(var f=c.categoryChecks[e].id,g=0;g<a.categoryPoints.length;g++)a.categoryPoints[e].cat==f&&d.push(a.categoryPoints[e])}else for(var e=0;e<a.categoryPoints.length;e++)d.push(a.categoryPoints[e]);if(0==d.length)return 0;for(var h=0,i=0,e=0;e<d.length;e++){if(0==d[e].maxPoints){if(0==d[e].studentPoints)continue;d[e].maxPoints=1}h+=d[e].weight;var j=d[e].studentPoints/d[e].maxPoints;i+=j*(d[e].weight/100)}return i=i*(1/h)*100},calculateCategoryGrades:function(a){for(var b=[],c=0;c<a.categoryPoints.length;c++){if(b[c]=[],0==a.categoryPoints[c].maxPoints){if(0==a.categoryPoints[c].studentPoints)continue;a.categoryPoints[c].maxPoints=1}b[c][0]=a.categoryPoints[c].studentPoints/a.categoryPoints[c].maxPoints,b[c][1]=a.categoryPoints[c].cat}return b}},Builder=function(a){this.dataRef=a,this.assignmentTbl=Retriever.getAssignmentTbl(),this.deleteButtons=[],this.realTrashHolder=document.createElement("div"),this.realTrash=[],this.fakeTrashHolder=document.createElement("div"),this.fakeTrash=[],this.contentHolder=document.createElement("div"),this.rightContentDiv=document.body.appendChild(document.createElement("div")),this.rightContentDiv.width=350,this.rightContentDiv.style.width=this.rightContentDiv.width+"px",this.rightContentDiv.style.position="fixed",this.rightContentDiv.style.left=window.innerWidth-this.rightContentDiv.width+"px",this.rightContentDiv.style.top="0px",this.rightContentDiv.style.backgroundColor="#FAF6DA",this.rightContentDiv.style.padding="5px",this.rightContentDiv.style.zIndex=9999999,this.bottomContentDiv=document.body.appendChild(document.createElement("div")),this.bottomContentDiv.width=window.innerWidth,this.bottomContentDiv.style.width=this.bottomContentDiv.width+"px",this.bottomContentDiv.height=50;var b=document.createElement("div");b.style.height=this.bottomContentDiv.height+"px",document.body.appendChild(b),this.bottomContentDiv.style.height=this.bottomContentDiv.height+"px",this.bottomContentDiv.style.position="fixed",this.bottomContentDiv.style.top=window.innerHeight-this.bottomContentDiv.height+"px",this.bottomContentDiv.style.left="0px",this.bottomContentDiv.style.padding="5px",this.bottomContentDiv.style.backgroundColor="#FAF6DA",this.bottomContentDiv.style.zIndex=9999999,this.calculateGradeButton=this.rightContentDiv.appendChild(document.createElement("input")),this.calculateGradeButton.type="button",this.calculateGradeButton.value="Calculate my grade with these categories:",this.calculateGradeButton.builder=this,this.categoryDiv=this.rightContentDiv.appendChild(document.createElement("div")),this.categoryChecks=[],this.categoryContainers=[],this.categoryGrades=[],this.addCategory=function(a){var b=this.categoryContainers.push(this.rightContentDiv.appendChild(document.createElement("span")))-1,c=this.categoryChecks.push(this.categoryContainers[b].appendChild(document.createElement("input")))-1;this.categoryChecks[c].type="checkbox",this.categoryChecks[c].id=a,this.categoryChecks[c].checked=!0,this.categoryContainers[b].innerHTML+=a+" - ";var d=this.categoryGrades.push(document.createElement("span"))-1;this.categoryGrades[d]=this.categoryContainers[b].appendChild(this.categoryGrades[d]),this.categoryGrades[d].innerHTML="%",this.categoryGrades[d].id=a+"grade",this.categoryContainers[b].innerHTML+="<br/>"};for(var c=0;c<a.categoryPoints.length;c++)this.addCategory(a.categoryPoints[c].cat);this.currentGradeDisplay=document.createElement("span"),this.rightContentDiv.appendChild(this.currentGradeDisplay),this.updateTotalGradeDisplay=function(a){a=Math.round(1e4*a)/100,this.currentGradeDisplay.innerHTML="Grade: "+a+"%<br/>"},this.updateTotalGradeDisplay(DataHandling.calculateTotalGrade(a,!1)),this.updateCategoryGradeDisplays=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d[0]||(d=[],d[0]=0),d=d[0],d=Math.round(1e4*d)/100,this.categoryGrades[c].innerHTML=b[c].weight+"% - "+d+"%"}},this.updateCategoryGradeDisplays(DataHandling.calculateCategoryGrades(this.dataRef),this.dataRef.categoryPoints),this.calculateGradeClicked=function(){var a=DataHandling.calculateTotalGrade(this.builder.dataRef,!0,this.builder);this.builder.updateTotalGradeDisplay(a)},this.calculateGradeButton.onclick=this.calculateGradeClicked,this.newAssignmentDiv=this.bottomContentDiv.appendChild(document.createElement("div")),this.newAssignmentDiv.id="newAssignmentDiv",this.newAssignmentDiv.innerHTML+="<b>New Assignment:</b> Category: ",this.categorySelection=this.newAssignmentDiv.appendChild(document.createElement("select"));for(var d,c=0;c<this.dataRef.categoryPoints.length;c++)d=document.createElement("option"),d.text=this.dataRef.categoryPoints[c].cat,this.categorySelection.add(d);this.categorySelection.id="categorySelection",this.categorySelection.builder=this,this.newAssignmentDiv.innerHTML+=" Assignment Name: ",this.newAssignmentNameTextField=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentNameTextField.type="text",this.newAssignmentNameTextField.id="newAssignmentNameTextField",this.newAssignmentNameTextField.builder=this,this.newAssignmentDiv.innerHTML+=" Max Score: ",this.newAssignmentMaxScoreField=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentMaxScoreField.type="number",this.newAssignmentMaxScoreField.builder=this,this.newAssignmentMaxScoreField.id="newAssignmentMaxScoreField",this.newAssignmentDiv.innerHTML+=" Your Projected Score: ",this.newAssignmentStudentScoreField=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentStudentScoreField.type="number",this.newAssignmentStudentScoreField.builder=this,this.newAssignmentStudentScoreField.id="newAssignmentStudentScoreField",this.newAssignmentDiv.innerHTML+="  ",this.newAssignmentAddButton=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentAddButton.type="button",this.newAssignmentAddButton.value="Add",this.newAssignmentAddButton.builder=this,this.newAssignmentAddButton.id="newAssignmentAddButton",this.addAssignment=function(a,b,c,d){var e=Math.round(c/d*1e4)/100,f=document.createElement("tr");f.style.backgroundColor="#EDF2F8",f.innerHTML='<td><div class="float_l padding_r5" style="min-width: 105px;">'+a+'<br><a href="" title='+b+">"+b+'</div></td><td style="width:100%;"></td><td>FakeDate<br></td><td nowrap=""><div>Score: '+c+"</div>"+c+" / "+d+" = "+e+'%</td><td class="list_text"><div style="width: 125px;"></div></td>',this.assignmentTbl.appendChild(f)},this.addAssignmentButtonClicked=function(){var a=this.builder.categorySelection.value,b=this.builder.newAssignmentNameTextField.value,c=this.builder.newAssignmentStudentScoreField.value,d=this.builder.newAssignmentMaxScoreField.value;this.builder.addAssignment(a,b,c,d),this.builder.dataRef.reset(),this.builder.reset()},this.newAssignmentAddButton.onclick=this.addAssignmentButtonClicked,this.deleteButtonClicked=function(){this.builder.deleteAssignment(this.rowNumber,this.builder),this.builder.dataRef.reset(),this.builder.reset()},this.createDeleteButtons=function(){for(var a=0;a<this.deleteButtons.length;a++)this.deleteButtons[a].parentNode.removeChild(this.deleteButtons[a]);this.deleteButtons=[];for(var a=0;a<this.assignmentTbl.children.length;a++){var b=Retriever.getAssignmentNameElement(this.assignmentTbl.children[a]);this.deleteButtons[a]=b.appendChild(document.createElement("input")),this.deleteButtons[a].type="button",this.deleteButtons[a].value="Delete",this.deleteButtons[a].rowNumber=a,this.deleteButtons[a].builder=this,this.deleteButtons[a].onclick=this.deleteButtonClicked}},this.createDeleteButtons(),this.deleteAssignment=function(a,b){var c=b.assignmentTbl.children[a];b.realTrash.push(b.realTrashHolder.appendChild(c))},this.reset=function(){this.assignmentTbl=Retriever.getAssignmentTbl(),this.newAssignmentDiv=document.getElementById(this.newAssignmentDiv.id),this.categorySelection=document.getElementById(this.categorySelection.id),this.newAssignmentNameTextField=document.getElementById(this.newAssignmentNameTextField.id),this.newAssignmentMaxScoreField=document.getElementById(this.newAssignmentMaxScoreField.id),this.newAssignmentStudentScoreField=document.getElementById(this.newAssignmentStudentScoreField.id),this.newAssignmentAddButton=document.getElementById(this.newAssignmentAddButton.id);for(var a=0;a<this.categoryChecks.length;a++){var b=this.categoryChecks[a].checked;this.categoryChecks[a]=document.getElementById(this.categoryChecks[a].id),this.categoryChecks[a].checked=b}for(var a=0;a<this.categoryGrades.length;a++)this.categoryGrades[a]=document.getElementById(this.categoryGrades[a].id);this.updateTotalGradeDisplay(DataHandling.calculateTotalGrade(this.dataRef,!0,this)),this.updateCategoryGradeDisplays(DataHandling.calculateCategoryGrades(this.dataRef),this.dataRef.categoryPoints),this.createDeleteButtons()}},StudentClassData=function(){this.weights=Retriever.scoresCategoryCollection(),this.assignments=Retriever.getAssignmentCollection(),this.categoryPoints=DataHandling.findCategoryPointsOf(this.assignments,this.weights),this.totalWeight=DataHandling.findTotalWeightOf(this.weights),this.reset=function(){this.weights=Retriever.scoresCategoryCollection(),this.assignments=Retriever.getAssignmentCollection(),this.categoryPoints=DataHandling.findCategoryPointsOf(this.assignments,this.weights),this.totalWeight=DataHandling.findTotalWeightOf(this.weights)}},studentData=new StudentClassData,builder=new Builder(studentData);builder.reset();