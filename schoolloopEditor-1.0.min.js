var NAME="Schoolloop Editor";var URL=window.location.href.split(/\/+|\./);var HTTP=URL[0];if(!URL[4]||URL[4]!="progress_report"){if(!URL[4]||URL[2]!="schoolloop"||URL[3]!="com"){alert("You must be on schoolloop for "+NAME+" to work")}else{alert("You must be on a progress report for "+NAME+" to work");}}var pageConstants={weightTitle:"Weight",weightScoreTitle:"Weight Score"};var constants={weightsCategory:"Category",weightsWeight:"Weight",assignmentCategory:"Category",assignmentName:"name",assignmentMaxScore:"maxScore",assignmentStudentScore:"studentScore"};var Retriever={getScoresTitles:function(){var attributesRow=document.getElementsByClassName("module_content")[0].getElementsByTagName("tr")[0];return attributesRow;},getScoresContent:function(){var tbl=document.getElementsByClassName("module_content")[0].getElementsByTagName("tr");tbl=[...tbl];tbl.shift();return tbl;},getScoresAttrOf:function(tblAttr){var attr=[];for(var i=0;i<tblAttr.children.length;i++){attr[i]=tblAttr.children[i].innerHTML.replace(":","");}return attr;},getScoresAttr:function(){var tblAttr=this.getScoresTitles();return this.getScoresAttrOf(tblAttr);},scoresCategoryCollection:function(){var collection=[];var scoresTbl=this.getScoresContent();var genAttr=this.getScoresAttr();for(var i=0;i<scoresTbl.length;i++){collection[i]=new Object();var currentRow=scoresTbl[i];for(var j=0;j<currentRow.children.length;j++){collection[i][genAttr[j]]=currentRow.children[j].innerHTML;}}return collection;},getGradeLegendTbl:function(){return document.getElementsByClassName("module_content")[2];},getGradeLegendCodesOf:function(gradeLegendTbl){var legendCodes=[];var rows=gradeLegendTbl.children[0].children[0].children;for(var i=1;i<rows.length;i++){legendCodes[i-1]=rows[i].children[0].innerText.split(":")[0];}return legendCodes;},getGradeLegendCodes:function(){var gradeLegendTbl=this.getGradeLegendTbl();return this.getGradeLegendCodesOf(gradeLegendTbl);},getAssignmentTbl:function(){var assignments=document.getElementsByClassName("general_body")[0];return assignments;},getAssignmentCategory:function(assignmentRow){return assignmentRow.children[0].children[0].innerText.split("\n")[0].trim().replace("&amp;","&");},getAssignmentName:function(assignmentRow){return assignmentRow.children[0].children[0].innerText.split("\n")[1].trim();},getAssignmentNameElement:function(assignmentRow){return assignmentRow.children[0].children[0]},getAssignmentScoreMax:function(assignmentRow){var assignmentScoreStr=assignmentRow.children[3].innerText;if(!assignmentScoreStr.split("/")[1]||!assignmentScoreStr.split("/")[1].split(" ")[1]){return 0;}return parseFloat(assignmentScoreStr.split("/")[1].split(" ")[1]);},getAssignmentScore:function(assignmentRow){if(!parseFloat(assignmentRow.children[3].children[0].innerText.split(" ")[1])){return 0;}return parseFloat(assignmentRow.children[3].children[0].innerText.split(" ")[1]);},getAssignmentCollection:function(){var assignmentCollection=[];var assignmentTbl=this.getAssignmentTbl();for(var i=0;i<assignmentTbl.children.length;i++){assignmentCollection[i]=new Object();assignmentCollection[i][constants.assignmentCategory]=this.getAssignmentCategory(assignmentTbl.children[i]).replace("&amp;","&");assignmentCollection[i][constants.assignmentName]=this.getAssignmentName(assignmentTbl.children[i]);assignmentCollection[i][constants.assignmentMaxScore]=this.getAssignmentScoreMax(assignmentTbl.children[i]);assignmentCollection[i][constants.assignmentStudentScore]=this.getAssignmentScore(assignmentTbl.children[i]);}return assignmentCollection;}};var DataHandling={findTotalWeightOf:function(weights){if(!weights||weights.length==0){return-1;}if(!weights[0][pageConstants.weightTitle]){return-1;}var totalWeight=0;for(var i=0;i<weights.length;i++){totalWeight+=parseFloat(weights[i][pageConstants.weightTitle]);}return totalWeight;},Category:function(){this.weight=0;this.cat="";this.studentPoints=0;this.maxPoints=0;},findCategoryPointsOf:function(assignments,weights){var categoryPoints=[];for(var i=0;i<weights.length;i++){categoryPoints[i]=new this.Category();if(!weights[i][constants.weightsCategory])categoryPoints[i].cat=i+"?";else categoryPoints[i].cat=weights[i][constants.weightsCategory];if(!weights[i][constants.weightsWeight])categoryPoints[i].weight=i+"?";else{var currentWeight=parseFloat(weights[i][constants.weightsWeight]);if(!currentWeight)currentWeight=0;categoryPoints[i].weight=currentWeight;}}for(var i=0;i<assignments.length;i++){var currentCategory=assignments[i][constants.assignmentCategory].replace("&amp;","&");var currentStudentPoints=assignments[i][constants.assignmentStudentScore];var currentMaxPoints=assignments[i][constants.assignmentMaxScore];for(var j=0;j<categoryPoints.length;j++){if(currentCategory==categoryPoints[j].cat){categoryPoints[j].maxPoints+=currentMaxPoints;categoryPoints[j].studentPoints+=currentStudentPoints;}}}return categoryPoints;},calculateTotalGrade:function(studentData,retrieveCategories,builder){var categories=[];if(retrieveCategories){for(var i=0;i<builder.categoryChecks.length;i++){if(builder.categoryChecks[i].checked){var currentCat=builder.categoryChecks[i].id;for(var j=0;j<studentData.categoryPoints.length;j++){if(studentData.categoryPoints[i].cat==currentCat)categories.push(studentData.categoryPoints[i]);}}}}else{for(var i=0;i<studentData.categoryPoints.length;i++){categories.push(studentData.categoryPoints[i]);}}if(categories.length==0){return 0;}var totalWeight=0;var totalGrade=0;for(var i=0;i<categories.length;i++){if(categories[i].maxPoints==0){if(categories[i].studentPoints==0)continue;categories[i].maxPoints=1;}totalWeight+=categories[i].weight;var catPercent=categories[i].studentPoints/categories[i].maxPoints;totalGrade+=catPercent*(categories[i].weight/100);}totalGrade=totalGrade*(1/totalWeight)*100;return totalGrade;},calculateCategoryGrades:function(studentData){var categoryGrades=[];for(var i=0;i<studentData.categoryPoints.length;i++){categoryGrades[i]=[];if(studentData.categoryPoints[i].maxPoints==0){if(studentData.categoryPoints[i].studentPoints==0)continue;studentData.categoryPoints[i].maxPoints=1;}categoryGrades[i][0]=studentData.categoryPoints[i].studentPoints/studentData.categoryPoints[i].maxPoints;categoryGrades[i][1]=studentData.categoryPoints[i].cat;}return categoryGrades;}};var Builder=function(studentData){this.dataRef=studentData;this.assignmentTbl=Retriever.getAssignmentTbl();this.deleteButtons=[];this.realTrashHolder=document.createElement("div");this.realTrash=[];this.fakeTrashHolder=document.createElement("div");this.fakeTrash=[];this.contentHolder=document.createElement("div");this.rightContentDiv=document.body.appendChild(document.createElement("div"));this.rightContentDiv.width=350;this.rightContentDiv.style.width=this.rightContentDiv.width+"px";this.rightContentDiv.style.position="fixed";this.rightContentDiv.style.left=window.innerWidth-this.rightContentDiv.width+"px";this.rightContentDiv.style.top="0px";this.rightContentDiv.style.backgroundColor="#FAF6DA";this.rightContentDiv.style.padding="5px";this.rightContentDiv.style.zIndex=9999999;this.bottomContentDiv=document.body.appendChild(document.createElement("div"));this.bottomContentDiv.width=window.innerWidth;this.bottomContentDiv.style.width=this.bottomContentDiv.width+"px";this.bottomContentDiv.height=50;var documentScrollOffset=document.createElement("div");documentScrollOffset.style.height=this.bottomContentDiv.height+"px";document.body.appendChild(documentScrollOffset);this.bottomContentDiv.style.height=this.bottomContentDiv.height+"px";this.bottomContentDiv.style.position="fixed";this.bottomContentDiv.style.top=window.innerHeight-this.bottomContentDiv.height+"px";this.bottomContentDiv.style.left="0px";this.bottomContentDiv.style.padding="5px";this.bottomContentDiv.style.backgroundColor="#FAF6DA";this.bottomContentDiv.style.zIndex=9999999;this.calculateGradeButton=this.rightContentDiv.appendChild(document.createElement("input"));this.calculateGradeButton.type="button";this.calculateGradeButton.value="Calculate my grade with these categories:";this.calculateGradeButton.builder=this;this.categoryDiv=this.rightContentDiv.appendChild(document.createElement("div"));this.categoryChecks=[];this.categoryContainers=[];this.categoryGrades=[];this.addCategory=function(category){var containerIndex=this.categoryContainers.push(this.rightContentDiv.appendChild(document.createElement("span")))-1;var checkIndex=this.categoryChecks.push(this.categoryContainers[containerIndex].appendChild(document.createElement("input")))-1;this.categoryChecks[checkIndex].type="checkbox";this.categoryChecks[checkIndex].id=category;this.categoryChecks[checkIndex].checked=true;this.categoryContainers[containerIndex].innerHTML+=category+" - ";var gradeIndex=this.categoryGrades.push(document.createElement("span"))-1;this.categoryGrades[gradeIndex]=this.categoryContainers[containerIndex].appendChild(this.categoryGrades[gradeIndex]);this.categoryGrades[gradeIndex].innerHTML="%";this.categoryGrades[gradeIndex].id=category+"grade";this.categoryContainers[containerIndex].innerHTML+="<br/>";};for(var i=0;i<studentData.categoryPoints.length;i++){this.addCategory(studentData.categoryPoints[i].cat);}this.currentGradeDisplay=document.createElement("span");this.rightContentDiv.appendChild(this.currentGradeDisplay);this.updateTotalGradeDisplay=function(grade){grade=Math.round(grade*10000)/100;this.currentGradeDisplay.innerHTML="Grade: "+grade+"%<br/>";};this.updateTotalGradeDisplay(DataHandling.calculateTotalGrade(studentData,false));this.updateCategoryGradeDisplays=function(categoryGrades,categoryPoints){for(var i=0;i<categoryGrades.length;i++){var currentGrade=categoryGrades[i];if(!currentGrade[0]){currentGrade=[];currentGrade[0]=0;}currentGrade=currentGrade[0];currentGrade=Math.round(currentGrade*10000)/100;this.categoryGrades[i].innerHTML=categoryPoints[i].weight+"% - "+currentGrade+"%";}};this.updateCategoryGradeDisplays(DataHandling.calculateCategoryGrades(this.dataRef),this.dataRef.categoryPoints);this.calculateGradeClicked=function(){var grade=DataHandling.calculateTotalGrade(this.builder.dataRef,true,this.builder);this.builder.updateTotalGradeDisplay(grade);};this.calculateGradeButton.onclick=this.calculateGradeClicked;this.newAssignmentDiv=this.bottomContentDiv.appendChild(document.createElement("div"));this.newAssignmentDiv.id="newAssignmentDiv";this.newAssignmentDiv.innerHTML+="<b>New Assignment:</b> Category: ";this.categorySelection=this.newAssignmentDiv.appendChild(document.createElement("select"));var newOption;for(var i=0;i<this.dataRef.categoryPoints.length;i++){newOption=document.createElement("option");newOption.text=this.dataRef.categoryPoints[i].cat;this.categorySelection.add(newOption);}this.categorySelection.id="categorySelection";this.categorySelection.builder=this;this.newAssignmentDiv.innerHTML+=" Assignment Name: ";this.newAssignmentNameTextField=this.newAssignmentDiv.appendChild(document.createElement("input"));this.newAssignmentNameTextField.type="text";this.newAssignmentNameTextField.id="newAssignmentNameTextField";this.newAssignmentNameTextField.builder=this;this.newAssignmentDiv.innerHTML+=" Max Score: ";this.newAssignmentMaxScoreField=this.newAssignmentDiv.appendChild(document.createElement("input"));this.newAssignmentMaxScoreField.type="number";this.newAssignmentMaxScoreField.builder=this;this.newAssignmentMaxScoreField.id="newAssignmentMaxScoreField";this.newAssignmentDiv.innerHTML+=" Your Projected Score: ";this.newAssignmentStudentScoreField=this.newAssignmentDiv.appendChild(document.createElement("input"));this.newAssignmentStudentScoreField.type="number";this.newAssignmentStudentScoreField.builder=this;this.newAssignmentStudentScoreField.id="newAssignmentStudentScoreField";this.newAssignmentDiv.innerHTML+="  ";this.newAssignmentAddButton=this.newAssignmentDiv.appendChild(document.createElement("input"));this.newAssignmentAddButton.type="button";this.newAssignmentAddButton.value="Add";this.newAssignmentAddButton.builder=this;this.newAssignmentAddButton.id="newAssignmentAddButton";this.addAssignment=function(category,name,studentScore,maxScore){var percent=Math.round((studentScore/maxScore)*10000)/100;var newAssignmentRow=document.createElement("tr");newAssignmentRow.style.backgroundColor="#EDF2F8";newAssignmentRow.innerHTML='<td><div class="float_l padding_r5" style="min-width: 105px;">'+category+'<br><a href="" title='+name+'>'+name+'</div></td><td style="width:100%;"></td><td>FakeDate<br></td><td nowrap=""><div>Score: '+studentScore+'</div>'+studentScore+' / '+maxScore+' = '+percent+'%</td><td class="list_text"><div style="width: 125px;"></div></td>';this.assignmentTbl.appendChild(newAssignmentRow);};this.addAssignmentButtonClicked=function(){var category=this.builder.categorySelection.value;var name=this.builder.newAssignmentNameTextField.value;var studentScore=this.builder.newAssignmentStudentScoreField.value;var maxScore=this.builder.newAssignmentMaxScoreField.value;this.builder.addAssignment(category,name,studentScore,maxScore);this.builder.dataRef.reset();this.builder.reset();};this.newAssignmentAddButton.onclick=this.addAssignmentButtonClicked;this.deleteButtonClicked=function(){this.builder.deleteAssignment(this.rowNumber,this.builder);this.builder.dataRef.reset();this.builder.reset();};this.createDeleteButtons=function(){for(var i=0;i<this.deleteButtons.length;i++){this.deleteButtons[i].parentNode.removeChild(this.deleteButtons[i]);}this.deleteButtons=[];for(var i=0;i<this.assignmentTbl.children.length;i++){var currentRow=Retriever.getAssignmentNameElement(this.assignmentTbl.children[i]);this.deleteButtons[i]=currentRow.appendChild(document.createElement("input"));this.deleteButtons[i].type="button";this.deleteButtons[i].value="Delete";this.deleteButtons[i].rowNumber=i;this.deleteButtons[i].builder=this;this.deleteButtons[i].onclick=this.deleteButtonClicked;}};this.createDeleteButtons();this.deleteAssignment=function(assignmentNumber,builder){var assignmentRowToDelete=builder.assignmentTbl.children[assignmentNumber];builder.realTrash.push(builder.realTrashHolder.appendChild(assignmentRowToDelete));};this.reset=function(){this.assignmentTbl=Retriever.getAssignmentTbl();this.newAssignmentDiv=document.getElementById(this.newAssignmentDiv.id);this.categorySelection=document.getElementById(this.categorySelection.id);this.newAssignmentNameTextField=document.getElementById(this.newAssignmentNameTextField.id);this.newAssignmentMaxScoreField=document.getElementById(this.newAssignmentMaxScoreField.id);this.newAssignmentStudentScoreField=document.getElementById(this.newAssignmentStudentScoreField.id);this.newAssignmentAddButton=document.getElementById(this.newAssignmentAddButton.id);for(var i=0;i<this.categoryChecks.length;i++){var checked=this.categoryChecks[i].checked;this.categoryChecks[i]=document.getElementById(this.categoryChecks[i].id);this.categoryChecks[i].checked=checked;}for(var i=0;i<this.categoryGrades.length;i++){this.categoryGrades[i]=document.getElementById(this.categoryGrades[i].id);}this.updateTotalGradeDisplay(DataHandling.calculateTotalGrade(this.dataRef,true,this));this.updateCategoryGradeDisplays(DataHandling.calculateCategoryGrades(this.dataRef),this.dataRef.categoryPoints);this.createDeleteButtons();};};var StudentClassData=function(){this.weights=Retriever.scoresCategoryCollection();this.assignments=Retriever.getAssignmentCollection();this.categoryPoints=DataHandling.findCategoryPointsOf(this.assignments,this.weights);this.totalWeight=DataHandling.findTotalWeightOf(this.weights);this.reset=function(){this.weights=Retriever.scoresCategoryCollection();this.assignments=Retriever.getAssignmentCollection();this.categoryPoints=DataHandling.findCategoryPointsOf(this.assignments,this.weights);this.totalWeight=DataHandling.findTotalWeightOf(this.weights);};};var studentData=new StudentClassData();var builder=new Builder(studentData);builder.reset();
